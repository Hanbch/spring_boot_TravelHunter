<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="edu.hi.prj.mapper.BookingMapper">

	<insert id="booking">
           <![CDATA[
           		insert into booking(num, member_id, place_num, room_num, startdate, enddate, cname, cphone, totalprice)
           		values(reservation_seq.nextval, #{member_id}, #{place_num}, #{room_num}, to_date(#{startdate},'mm-dd-yy'),to_date(#{enddate},'mm-dd-yy'), #{cname}, #{cphone}, #{totalprice})
   			]]>
	</insert>

	<insert id="reserved">
           <![CDATA[
           		insert into reserved (booking_num,room_num,rdate)
           		values(reservation_seq.currval,#{room_num}, to_date(#{rdate},'mm-dd-yy'))
   			]]>
	</insert>

	<select id="getBookingInfo" resultType="BookingInfoVO">
           <![CDATA[
           		select p.num place_num, r.num room_num, pname,rname,price,capacity,rinfo from place p,room r where p.num = r.place_num and r.num = #{room_num}
   			]]>
	</select>

	<select id="getRsvList" resultType="BookingVO">
           <![CDATA[
           		select * from booking b,place p,room r where b.member_id = #{member_id} and b.room_num = r.num and p.num = r.place_num and enddate > sysdate
   			]]>
	</select>

	<select id="getManagerRsvList" resultType="BookingVO">
           <![CDATA[
           		select * from booking b,place p,room r where p.member_id = #{member_id} and b.room_num = r.num and p.num = r.place_num and enddate > sysdate
   			]]>
	</select>

	<select id="getRsvedList" resultType="BookingVO">
           <![CDATA[
           		select * from booking b,place p,room r where b.member_id = #{member_id} and b.room_num = r.num and p.num = r.place_num and enddate < sysdate
   			]]>
	</select>
	
	<select id="getManagerRsvedList" resultType="BookingVO">
           <![CDATA[
           		select * from booking b,place p,room r where b.member_id = #{member_id} and b.room_num = r.num and p.num = r.place_num and enddate < sysdate
   			]]>
	</select>

	<delete id="rsvdelete">
       <![CDATA[
          delete from booking where num = #{num}
       ]]>
	</delete>

	<insert id="withdraworder">
           <![CDATA[
           		insert into withdraworder(booking_num, member_id, place_num, startdate, enddate, cname, cphone, pname, room_num, totalprice)
           		values(#{num}, #{member_id}, #{place_num}, to_date(#{startdate},'yyyy-mm-dd HH24:MI:SS'), to_date(#{enddate},'yyyy-mm-dd HH24:MI:SS'), #{cname}, #{cphone}, #{pname},#{room_num}, #{totalprice})
   			]]>
	</insert>

	<select id="withdraworderList" resultType="BookingVO">
           <![CDATA[
           		select booking_num num, place_num, startdate, enddate, cname, cphone, member_id, pname, totalprice 
           		from withdraworder where member_id = #{member_id}
   			]]>
	</select>
	
	<select id="managerWithdrawOrderList" resultType="BookingVO">
           <![CDATA[
           		select booking_num num, w.place_num, startdate, enddate, rname, price,cname, cphone, p.member_id, p.pname, totalprice 
           		from withdraworder w, place p, room r 
   					where p.member_id = #{member_id} and w.place_num = p.num and p.num = r.place_num and w.room_num = r.num
   			]]>
	</select>

</mapper>